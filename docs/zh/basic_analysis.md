# **基础分析**

##             1.**作用域层次（scope hierarchy）分析**

作用域分析用于确定符号(symbol，包括变量、函数、类等等)的作用范围，符号在哪一部分代码中生效。lian会对整个文件的作用域进行探测，捋清文件中各个作用域中包含的符号，并以树形结构存储作用域与符号信息。

##             2.**入口点（entry_points）搜索**

入口点由basic_analysis.py中的find_entry_point()函数确定。可根据实际情况在entry_point.py文件中EntryPointGenerator类的entry_point_rule字段自定义入口函数。

##             3.**控制流分析**

##             4.**指令级def/use 分析**

语句定义/使用分析(def/use analysis)用于追踪程序中每个语句的符号（即标识符）定义与引用关系，这一阶段的def/use仅针对单条语句进行流不敏感的分析。根据控制流图的顺序逐条语句进行def/use分析。每分析完一条语句，产生该语句的语义信息(status)，并将def/use的信息存储到symbol_to_defined和symbol_to_used两个表中。两个表作用如下：

1 symbol_to_defined映射表：

结构：(method_id, symbol_id, set[stmt_id])

功能：在指定方法作用域内，快速定位定义特定符号的所有语句

2 symbol_to_used映射表：

结构：(method_id, symbol_id, set[stmt_id])

功能：在指定方法作用域内，快速检索使用特定符号的所有语句

##             5.**文件依赖（import dependency）**

对于import依赖分析，一个文件能够使用其他文件中定义的符号。import语句的语法灵活多变，导入的目标可能是一个文件，或者是一个目录，或者是一个符号。例如：

\```

from A import B

from A import *

\```

"A"是一个文件时，"B"与"*"代表导入的符号，而当"A"是一个目录时，"B"与"*"可能代表多个文件或者目录。因此通过确定"A"的类型与内容，来确定"B"与"*"内容。

因为在作用域层次分析中确定了每个符号的作用范围，依据此结果首先为每个文件建立一个导出符号表(export symbol table)，存放该文件内定义的可以导出的符号。

然后根据具体的import语句判断导入的目标如果导入的目标是一个文件，则将目标文件的导出符号表中的内容加入到原文件的导出符号表，即目标文件中的符号“传递”到了原文件。如果导入的目标是一个目录，则将目标目录作为一个符号加入到原文件的导出符号表中。如果导入的目标是一个符号，则将该符号从目标文件的导出符号表加入到原文件的导出符号表

## **6.类型层级 （type hierarchy）**

在此步骤中，我们需要分析程序的类型层次结构，重点解析类之间的继承关系。该分析过程分为两个阶段：

第一阶段（类级分析）：

通过作用域层次结构中的analyze_type_hierarchy函数，提取每个类的方法信息（暂不处理父类）。同时，在类型关系图(type_graph)中保存类与其父类的继承关系——以带属性的有向边表示：从当前类指向每个父类，边的属性包含父类名称及其继承顺序位次。

第二阶段（继承关系分析）：

遍历类型关系图(type_graph)，当检测到类A存在父类B时，通过拓扑排序迭代处理所有后继节点，将父类B的方法集合合并到子类A的方法集合中。

## **7.根据callee对函数进行分类**

基础分析的最后一步便是对函数进行分类，在后续的分析中，将会以函数为基本单位进行分析，如果一个函数中存在对其他函数的调用，则需要先分析被调用函数，得到结果，再将该结果应用到调用者函数。需要把函数分成no_callees，only_direct_callees，mixed_direct_callees，only_dynamic_callees四类。以便后续第二阶段分析能够以正确的顺序分析函数。